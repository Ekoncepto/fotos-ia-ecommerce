# Story 1.5: redirecionamento-login

## Status

Draft

## Story

**As a** user,
**I want** to be redirected to the login page if I am not authenticated,
**so that** I can log in to access the application.

## Acceptance Criteria

1. When an unauthenticated user tries to access any page other than the login page or the auth callback page, they should be redirected to the `/login` page.
2. When an authenticated user tries to access the `/login` page, they should be redirected to the home page.
3. Unauthenticated users should be able to access the `/login` page.
4. The auth callback page should be accessible to handle the OAuth redirect.

## Tasks / Subtasks

- [ ] Modify `apps/web/middleware.ts` to implement the authentication and redirection logic.
- [ ] Create `apps/web/lib/supabase/middleware.ts` to handle Supabase client creation in the middleware.
- [ ] Update the `matcher` in the middleware configuration to include all relevant paths.

## Dev Notes

The implementation should use `@supabase/ssr` for handling the user session in the middleware.
The middleware should protect all routes except for public routes like `/login`, `/auth/callback`, and error pages.

### Testing

- Test that unauthenticated users are redirected to `/login`.
- Test that authenticated users can access protected pages.
- Test that authenticated users are redirected from `/login` to the home page.
- Test that the login flow (including the callback) still works correctly.

## Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-09-07 | 1.0 | Initial draft | Gemini |
