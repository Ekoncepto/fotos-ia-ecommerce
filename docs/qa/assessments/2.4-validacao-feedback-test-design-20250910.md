# Test Design: Story 2.4

Date: 2025-09-10
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 15
- Unit tests: 5 (33%)
- Integration tests: 6 (40%)
- E2E tests: 4 (27%)
- Priority distribution: P0: 6, P1: 7, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: UI de avalia√ß√£o (üëç/üëé)

| ID              | Level | Priority | Test                                                                 | Justification |
|-----------------|-------|----------|----------------------------------------------------------------------|---------------|
| 2.4-UNIT-001    | Unit  | P0       | Render dos bot√µes üëç/üëé por imagem                                    | Core UI |
| 2.4-UNIT-002    | Unit  | P1       | A11y: teclado/labels; estados selecionados                            | Accessibility |
| 2.4-E2E-001     | E2E   | P0       | Clique em üëç/üëé registra avalia√ß√£o                                     | UX-critical |

### AC2: Lista de motivos ao clicar üëé

| ID              | Level       | Priority | Test                                                                 | Justification |
|-----------------|-------------|----------|----------------------------------------------------------------------|---------------|
| 2.4-UNIT-003    | Unit        | P0       | Motivos predefinidos s√£o exibidos corretamente                        | Core behavior |
| 2.4-INT-001     | Integration | P1       | Envio do motivo √© persistido conforme contrato                        | Contract |

### AC3: Descartar imagem sem consumir cr√©ditos

| ID              | Level       | Priority | Test                                                                 | Justification |
|-----------------|-------------|----------|----------------------------------------------------------------------|---------------|
| 2.4-INT-002     | Integration | P0       | Opera√ß√£o de descarte √© idempotente e n√£o altera cr√©ditos              | Accounting correctness |
| 2.4-E2E-002     | E2E         | P0       | Descartar remove imagem da galeria e mant√©m saldo de refinamentos     | UX/business |

### AC4: Feedback armazenado para an√°lise

| ID              | Level       | Priority | Test                                                                 | Justification |
|-----------------|-------------|----------|----------------------------------------------------------------------|---------------|
| 2.4-INT-003     | Integration | P1       | Persist√™ncia com schema versionado e carimbo de tempo                 | Analytics reliability |
| 2.4-INT-004     | Integration | P1       | Consulta/relat√≥rio retorna dados agregados por motivo                 | Analytics |

### AC5: Sem regress√µes em gerenciamento de imagens/cr√©ditos

| ID              | Level | Priority | Test                                                                 | Justification |
|-----------------|-------|----------|----------------------------------------------------------------------|---------------|
| 2.4-E2E-003     | E2E   | P0       | Fluxos de aceitar/baixar imagens permanecem funcionando               | Regression guard |
| 2.4-UNIT-004    | Unit  | P1       | Snapshot visual da galeria p√≥s-a√ß√£o de descarte                       | Visual regression |

### Seguran√ßa/Privacidade/Autoriza√ß√£o

| ID              | Level       | Priority | Test                                                                 | Justification |
|-----------------|-------------|----------|----------------------------------------------------------------------|---------------|
| 2.4-INT-005     | Integration | P1       | Autoriza√ß√£o: somente dono do pacote pode descartar/avaliar            | AuthZ correctness |
| 2.4-UNIT-005    | Unit        | P2       | Anonimiza√ß√£o/retention configuradas para feedback                      | Privacy hygiene |
| 2.4-E2E-004     | E2E         | P1       | Tentativa de a√ß√£o n√£o autorizada √© bloqueada com mensagem clara       | Security UX |

## Risk Coverage

- TECH-001 (High): 2.4-INT-002, 2.4-E2E-002
- DATA-001 (High): 2.4-UNIT-005, 2.4-INT-003/004
- SEC-001 AuthZ: 2.4-INT-005, 2.4-E2E-004

## Recommended Execution Order

1. P0 accounting+UX: 2.4-INT-002, 2.4-E2E-002, 2.4-UNIT-001/003, 2.4-E2E-001
2. P1 analytics+authz+regression: 2.4-INT-001/003/004/005, 2.4-E2E-003, 2.4-UNIT-002/004
3. P2 privacy hygiene: 2.4-UNIT-005

## Notes & Implementation Hints

- Tornar descarte idempotente; definir contrato claro de cr√©dito x descarte.
- Schema versionado para motivos; preferir motivos predefinidos; texto livre opcional e sanitizado.
- Enforce AuthZ nas rotas de avalia√ß√£o/descartar com logs de auditoria.

## Test Artifact Pointers

- Unit/UI: apps/web/components/feedback/__tests__/rating.test.tsx
- Integration: apps/server/tests/feedback.integration.test.ts
- E2E: apps/web/tests/feedback-flow.spec.ts

## Gate Block (pasteable)

test_design:
  scenarios_total: 15
  by_level:
    unit: 5
    integration: 6
    e2e: 4
  by_priority:
    p0: 6
    p1: 7
    p2: 2
  coverage_gaps: []

## Trace References

Story: docs/stories/2.4.validacao-feedback.md
Risk profile: docs/qa/assessments/2.4-validacao-feedback-risk-20250910.md

